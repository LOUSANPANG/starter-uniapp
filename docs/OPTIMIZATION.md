## 微信小程序优化文档


### 界面
- 图片：避免使用大图;
- 图片：避免滥用 image 组件的 widthFix/heightFix 模式；
- 节点：减少组件数量、减少节点嵌套层级;
- 交互通信：scroll-view尤其注意视图层和逻辑层频繁进行通讯;
- 交互通信：长列表使用ulist，具有自动回收机制;
- 交互通信：左右滑动的长列表推荐新闻模板;
- 提取组件：微博长列表页面，点击一个点赞图标，赞数要立即+1，此时这个点赞按钮一定要做成组件。否则这个+1会引发页面级所有数据的从js层向视图层的同步；
- 宽屏适配：leftWindow
- 宽屏适配：topWindow
- 宽屏适配：rightWindow


### 逻辑
- data数据：合理使用优化数据、减少一次性节点数量，延迟setdata;
- 高性能操作：适当监听页面或组件的 scroll 事件；
- 高性能操作：选择高性能的动画实现方式；
- 高性能操作：使用 IntersectionObserver 监听元素曝光；
- 生命周期：避免在 onHide/onUnload 执行耗时操作；
- 启用多线程worker：一些异步处理的任务


### 系统
- 打包：开启摇树优化;
- 打包：页面初始渲染缓存配置 initialRenderingCache；
- 分包：分包预下载；
- 分包：分包异步化(允许通过一些配置和新的接口，使部分跨分包的内容可以等待下载后异步使用，从而一定程度上解决这个限制)；
- 代码注入优化(按需注入和用时注入)：避免启动页面所在的主包或者分包文件全部加载；
- 代码注入优化(按需注入和用时注入)：{"lazyCodeLoading": "requiredComponents"}；
- 初始渲染缓存：使视图层不需要等待逻辑层初始化完毕，而直接提前将页面初始 data 的渲染结果展示给用户
- 系统分析：内存分析
- 系统分析：处理内存告警
- 周期性更新：能够在用户未打开小程序的情况下，也能从服务器提前拉取数据
- 数据预拉取：在小程序冷启动的时候通过微信后台提前向第三方服务器拉取业务数据


### 加载
- 新页面渲染和窗体进入动画抢资源，造成页面切换卡顿、掉帧。建议延时100ms~300ms渲染图片或复杂原生组件，分批进行数据通讯，以减少一次性渲染的节点数量;
- 生命周期：提前发起数据请求；
- 生命周期：首屏渲染优化；


### 实用工具
- 高性能渲染优先选用 `wxs`
- 高性能渲染优先选用 `renderjs`



## app优化文档

### 加载
- App-nvue和H5，支持页面预载，uni.preloadPage，可以提供更好的使用体验;
- 优化背景闪白；将样式写在 App.vue 里、或者package json的各页面style里边;
```
"style": {  
	"app-plus": {  
		"background":"#000000"
	}  
}
```


### 界面


### 系统
- 打包：App端不需要地图、蓝牙等这些模块，可以裁剪掉，以缩小发行包体积。在 manifest.json-App模块权限里可以选择;


### 工具
- renderjs：canvas里做跟手操作，app端建议使用